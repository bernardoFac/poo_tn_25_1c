@startuml
actor Usuario
participant PlataformaStreaming as PS
participant Usuario       as U
participant Perfil        as P
participant Pelicula      as M
participant Reproduccion  as R

Usuario -> PS : iniciarReproduccion(int idUsuario,String nombrePerfil,int idPelicula,\n dispositivoIP)
activate PS
PS -> PS : buscarUsuario(int idUsuario)
alt usuario no existe
PS-->Usuario: ExpectionMessage("Usuario no encontrado")
else
activate U
PS -> U  : getPerfil(String nombrePerfil)
alt perfil no existe
U -->PS: None
PS --> Usuario:ExceptionMessage("El perfil indicado no existe")
else
U --> PS  : Perfil perfil
deactivate U

PS -> PS : buscarPelicula(int idPelicula)
alt pelicula no existe
PS -->Usuario: ExceptionMessage("La pelicula no existe")
else
    PS--> U : buscarDispositivo(int dispositivoIp)
activate U
U->U: getDispositivo(int dispositivoIp)
alt dispositivo existe
    U --> PS  : Dispositivo dispositivo
    deactivate U
else dispositivo nuevo
    PS -> PS : crearDispositivo(int ip)
    PS -> PS: Dispositivo(int ip)
    PS->U: agregarDispositivo(Dispositivo dispositivo)
end
PS -> P : iniciarReproduccion(Pelicula pelicula, Dispositivo dispositivo)
activate P
P -> R : Reproduccion(Pelicula pelicula, Dispositivo dispositivo)
activate R
R --> P: Reproduccion reproduccion
deactivate R
P->P: agregarAHistorial(Reproduccion reproduccion)
P-->PS: Reproduccion reproduccion
PS --> Usuario : Reproduccion reproduccion
deactivate P
deactivate PS
end
end
end
@enduml